var FlipClock;(function($){FlipClock=function(obj,digit,options){return new FlipClock.Factory(obj,digit,options)};FlipClock.Lang={};FlipClock.Base=Base.extend({buildDate:"2013-11-07",version:"0.3.1",constructor:function(_default,options){if(typeof _default!=="object"){_default={}}if(typeof options!=="object"){options={}}this.setOptions($.extend(true,{},_default,options))},callback:function(method){if(typeof method==="function"){var args=[];for(var x=1;x<=arguments.length;x++){if(arguments[x]){args.push(arguments[x])}}method.apply(this,args)}},log:function(str){if(window.console&&console.log){console.log(str)}},getOption:function(index){if(this[index]){return this[index]}return false},getOptions:function(){return this},setOption:function(index,value){this[index]=value},setOptions:function(options){for(var key in options){if(typeof options[key]!=="undefined"){this.setOption(key,options[key])}}}});FlipClock.Factory=FlipClock.Base.extend({autoStart:true,callbacks:{destroy:false,create:false,init:false,interval:false,start:false,stop:false,reset:false},classes:{active:"flip-clock-active",before:"flip-clock-before",divider:"flip-clock-divider",dot:"flip-clock-dot",label:"flip-clock-label",flip:"flip",play:"play",wrapper:"flip-clock-wrapper"},clockFace:"HourlyCounter",defaultClockFace:"HourlyCounter",defaultLanguage:"english",language:"english",lang:false,face:true,running:false,time:false,timer:false,lists:[],$wrapper:false,constructor:function(obj,digit,options){this.lists=[];this.running=false;this.base(options);this.$wrapper=$(obj).addClass(this.classes.wrapper);this.time=new FlipClock.Time(this,digit?Math.round(digit):0);this.timer=new FlipClock.Timer(this,options);this.lang=this.loadLanguage(this.language);this.face=this.loadClockFace(this.clockFace,options);if(this.autoStart){this.start()}},loadClockFace:function(name,options){var face,suffix="Face";name=name.ucfirst()+suffix;if(FlipClock[name]){face=new FlipClock[name](this,options)}else{face=new FlipClock[this.defaultClockFace+suffix](this,options)}face.build();return face},loadLanguage:function(name){var lang;if(FlipClock.Lang[name.ucfirst()]){lang=FlipClock.Lang[name.ucfirst()]}else{if(FlipClock.Lang[name]){lang=FlipClock.Lang[name]}else{lang=FlipClock.Lang[this.defaultLanguage]}}return lang},localize:function(index,obj){var lang=this.lang;if(!index){return null}var lindex=index.toLowerCase();if(typeof obj=="object"){lang=obj}if(lang&&lang[lindex]){return lang[lindex]}return index},start:function(callback){var t=this;if(!t.running&&(!t.countdown||t.countdown&&t.time.time>0)){t.face.start(t.time);t.timer.start(function(){t.flip();if(typeof callback==="function"){callback()}})}else{t.log("Trying to start timer when countdown already at 0")}},stop:function(callback){this.face.stop();this.timer.stop(callback);for(var x in this.lists){this.lists[x].stop()}},reset:function(callback){this.timer.reset(callback);this.face.reset()},setTime:function(time){this.time.time=time;this.face.setTime(time)},getTime:function(time){return this.time},setCountdown:function(value){var running=this.running;this.countdown=value?true:false;if(running){this.stop();this.start()}},flip:function(){this.face.flip()}});FlipClock.Face=FlipClock.Base.extend({dividers:[],factory:false,lists:[],constructor:function(factory,options){this.base(options);this.factory=factory;this.dividers=[]},build:function(){},createDivider:function(label,css,excludeDots){if(typeof css=="boolean"||!css){excludeDots=css;css=label}var dots=['<span class="'+this.factory.classes.dot+' top"></span>','<span class="'+this.factory.classes.dot+' bottom"></span>'].join("");if(excludeDots){dots=""}label=this.factory.localize(label);var html=['<span class="'+this.factory.classes.divider+" "+(css?css:"").toLowerCase()+'">','<span class="'+this.factory.classes.label+'">'+(label?label:"")+"</span>",dots,"</span>"];return $(html.join(""))},createList:function(digit,options){if(typeof digit==="object"){options=digit;digit=0}var obj=new FlipClock.List(this.factory,digit,options);return obj},reset:function(){},setTime:function(time){this.flip(time)},addDigit:function(digit){var obj=this.createList(digit,{classes:{active:this.factory.classes.active,before:this.factory.classes.before,flip:this.factory.classes.flip}});obj.$obj.insertBefore(this.factory.lists[0].$obj);this.factory.lists.unshift(obj)},start:function(){},stop:function(){},flip:function(time,doNotAddPlayClass){var t=this;if(!doNotAddPlayClass){if(!t.factory.countdown){t.factory.time.time++}else{if(t.factory.time.time<=0){t.factory.stop()}t.factory.time.time--}}var offset=t.factory.lists.length-time.length;if(offset<0){offset=0}var totalNew=0;var reFlip=false;$.each(time,function(i,digit){i+=offset;var list=t.factory.lists[i];if(list){var currentDigit=list.digit;list.select(digit);if(digit!=currentDigit&&!doNotAddPlayClass){list.play()}}else{t.addDigit(digit);reFlip=true}});for(var x=0;x<time.length;x++){if(x>=offset&&t.factory.lists[x].digit!=time[x]){t.factory.lists[x].select(time[x])}}}});FlipClock.List=FlipClock.Base.extend({digit:0,classes:{active:"flip-clock-active",before:"flip-clock-before",flip:"flip"},factory:false,$obj:false,items:[],constructor:function(factory,digit,options){this.factory=factory;this.digit=digit;this.$obj=this.createList();if(digit>0){this.select(digit)}this.factory.$wrapper.append(this.$obj)},select:function(digit){if(typeof digit==="undefined"){digit=this.digit}else{this.digit=digit}var target=this.$obj.find('[data-digit="'+digit+'"]');var active=this.$obj.find("."+this.classes.active).removeClass(this.classes.active);var before=this.$obj.find("."+this.classes.before).removeClass(this.classes.before);if(!this.factory.countdown){if(target.is(":first-child")){this.$obj.find(":last-child").addClass(this.classes.before)}else{target.prev().addClass(this.classes.before)}}else{if(target.is(":last-child")){this.$obj.find(":first-child").addClass(this.classes.before)}else{target.next().addClass(this.classes.before)}}target.addClass(this.classes.active)},play:function(){this.$obj.addClass(this.factory.classes.play)},stop:function(){var t=this;setTimeout(function(){t.$obj.removeClass(t.factory.classes.play)},this.factory.timer.interval)},createList:function(){var html=$('<ul class="'+this.classes.flip+" "+(this.factory.running?this.factory.classes.play:"")+'" />');for(var x=0;x<10;x++){var item=$(['<li data-digit="'+x+'">','<a href="#">','<div class="up">','<div class="shadow"></div>','<div class="inn">'+x+"</div>","</div>",'<div class="down">','<div class="shadow"></div>','<div class="inn">'+x+"</div>","</div>","</a>","</li>"].join(""));this.items.push(item);html.append(item)}return html}});FlipClock.Time=FlipClock.Base.extend({minimumDigits:0,time:0,factory:false,constructor:function(factory,time,options){this.base(options);this.factory=factory;if(time){this.time=time}},convertDigitsToArray:function(str){var data=[];str=str.toString();for(var x=0;x<str.length;x++){if(str[x].match(/^\d*$/g)){data.push(str[x])}}return data},digit:function(i){var timeStr=this.toString();var length=timeStr.length;if(timeStr[length-i]){return timeStr[length-i]}return false},digitize:function(obj){var data=[];$.each(obj,function(i,value){value=value.toString();if(value.length==1){value="0"+value}for(var x=0;x<value.length;x++){data.push(value.charAt(x))}});if(data.length>this.minimumDigits){this.minimumDigits=data.length}if(this.minimumDigits>data.length){data.unshift("0")}return data},getDayCounter:function(includeSeconds){var digits=[this.getDays(),this.getHours(true),this.getMinutes(true)];if(includeSeconds){digits.push(this.getSeconds(true))}return this.digitize(digits)},getDays:function(mod){var days=this.time/60/60/24;if(mod){days=days%7}return Math.floor(days)},getHourCounter:function(){var obj=this.digitize([this.getHours(),this.getMinutes(true),this.getSeconds(true)]);return obj},getHourly:function(){return this.getHourCounter()},getHours:function(mod){var hours=this.time/60/60;if(mod){hours=hours%24}return Math.floor(hours)},getMilitaryTime:function(){var date=new Date();var obj=this.digitize([date.getHours(),date.getMinutes(),date.getSeconds()]);return obj},getMinutes:function(mod){var minutes=this.time/60;if(mod){minutes=minutes%60}return Math.floor(minutes)},getMinuteCounter:function(){var obj=this.digitize([this.getMinutes(),this.getSeconds(true)]);return obj},getSeconds:function(mod){var seconds=this.time;if(mod){if(seconds==60){seconds=0}else{seconds=seconds%60}}return Math.ceil(seconds)},getTime:function(){var date=new Date();var hours=date.getHours();var merid=hours>12?"PM":"AM";var obj=this.digitize([hours>12?hours-12:(hours===0?12:hours),date.getMinutes(),date.getSeconds()]);return obj},getWeeks:function(){var weeks=this.time/60/60/24/7;if(mod){weeks=weeks%52}return Math.floor(weeks)},removeLeadingZeros:function(totalDigits,digits){var total=0;var newArray=[];$.each(digits,function(i,digit){if(i<totalDigits){total+=parseInt(digits[i],10)}else{newArray.push(digits[i])}});if(total===0){return newArray}return digits},toString:function(){return this.time.toString()}});FlipClock.Timer=FlipClock.Base.extend({callbacks:{destroy:false,create:false,init:false,interval:false,start:false,stop:false,reset:false},count:0,factory:false,interval:1000,constructor:function(factory,options){this.base(options);this.factory=factory;this.callback(this.callbacks.init);this.callback(this.callbacks.create)},getElapsed:function(){return this.count*this.interval},getElapsedTime:function(){return new Date(this.time+this.getElapsed())},reset:function(callback){clearInterval(this.timer);this.count=0;this._setInterval(callback);this.callback(this.callbacks.reset)},start:function(callback){this.factory.running=true;this._createTimer(callback);this.callback(this.callbacks.start)},stop:function(callback){this.factory.running=false;this._clearInterval(callback);this.callback(this.callbacks.stop);this.callback(callback)},_clearInterval:function(){clearInterval(this.timer)},_createTimer:function(callback){this._setInterval(callback)},_destroyTimer:function(callback){this._clearInterval();this.timer=false;this.callback(callback);this.callback(this.callbacks.destroy)},_interval:function(callback){this.callback(this.callbacks.interval);this.callback(callback);this.count++},_setInterval:function(callback){var t=this;t.timer=setInterval(function(){t._interval(callback)},this.interval)}});String.prototype.ucfirst=function(){return this.substr(0,1).toUpperCase()+this.substr(1)};$.fn.FlipClock=function(digit,options){if(typeof digit=="object"){options=digit;digit=0}return new FlipClock($(this),digit,options)};$.fn.flipClock=function(digit,options){return $.fn.FlipClock(digit,options)}}(jQuery));