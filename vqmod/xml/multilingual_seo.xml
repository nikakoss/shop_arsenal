<modification>
	<id>Complete SEO Package</id>
	<version>2.0.2 for 1.5.2 to 1.5.6</version>
	<vqmver>2.2.1</vqmver>
	<author>Sirius-Dev</author>
	
	<file name="system/startup.php">
	
		<operation>
			<search position="before"><![CDATA[?>]]></search>
			<add><![CDATA[require_once(DIR_SYSTEM . 'library/multilingual_seo.php');]]></add>
		</operation>
		
	</file>
	
	<file name="catalog/controller/module/language.php">
		
		<operation>
			<search position="replace"><![CDATA[$this->redirect($this->request->post['redirect']);]]></search>
			<add><![CDATA[
				if (isset($this->request->server['HTTPS']) && (($this->request->server['HTTPS'] == 'on') || ($this->request->server['HTTPS'] == '1'))) {
          $connection = 'SSL';
       		 } else {
				  $connection = 'NONSSL';
				}
				$redir_route = $this->request->post['redirect'];
				if($redir_params = strstr($redir_route, '&'))
					$redir_route = str_replace($redir_params, '', $redir_route);
				else $redir_params = '';
				$this->redirect($this->url->link($redir_route, str_replace('&amp;', '&', $redir_params), $connection));
			]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[$this->data['redirect'] = $this->url->link('common/home');]]></search>
			<add><![CDATA[$this->data['redirect'] = 'common/home';]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[$this->data['redirect'] = $this->url->link($route, $url, $connection);]]></search>
			<add><![CDATA[$this->data['redirect'] = $route . $url;]]></add>
		</operation>
		<operation>
			<search position="after"><![CDATA[unset($data['_route_']);]]></search>
			<add><![CDATA[unset($data['site_language']);]]></add>
		</operation>
		
	</file>
	
	<file name="admin/language/english/catalog/*.php">
	
		<operation error="skip">
			<search position="replace"><![CDATA['SEO Keyword:<br /><span class="help">Do not use spaces instead replace spaces with - and make sure the keyword is globally unique.</span>']]></search>
			<add><![CDATA['SEO Keyword:']]></add>
		</operation>
		
	</file>
	
	<file name="admin/controller/catalog/category.php">
	
		<operation>
			<search position="replace" offset="6"><![CDATA[if (isset($this->request->post['keyword'])) {]]></search>
			<add trim="true"><![CDATA[]]></add>
		</operation>
		
		<operation>
			<search position="replace" offset="4"><![CDATA[foreach ($this->request->post['category_description'] as $language_id => $value) {]]></search>
			<add trim="true"><![CDATA[
				$default_lang = $this->db->query("SELECT language_id FROM " . DB_PREFIX . "language WHERE code = '" . $this->config->get('config_language') . "'")->row['language_id'];
				foreach ($this->request->post['category_description'] as $language_id => $value) {
					if($language_id == $default_lang){
						if ((strlen(utf8_decode($value['name'])) < 2) || (strlen(utf8_decode($value['name'])) > 255)) {
							$this->error['name'][$language_id] = $this->language->get('error_name');
						}
					}
				}
			]]></add>
		</operation>
		
	</file>
	
	<file name="admin/controller/catalog/information.php">
	
		<operation>
			<search position="replace" offset="6"><![CDATA[if (isset($this->request->post['keyword'])) {]]></search>
			<add trim="true"><![CDATA[]]></add>
		</operation>
		
		<operation>
			<search position="replace" offset="8"><![CDATA[foreach ($this->request->post['information_description'] as $language_id => $value) {]]></search>
			<add trim="true"><![CDATA[
				$default_lang = $this->db->query("SELECT language_id FROM " . DB_PREFIX . "language WHERE code = '" . $this->config->get('config_language') . "'")->row['language_id'];
				foreach ($this->request->post['information_description'] as $language_id => $value) {
					if($language_id == $default_lang){
						if ((strlen(utf8_decode($value['title'])) < 3) || (strlen(utf8_decode($value['title'])) > 64)) {
							$this->error['title'][$language_id] = $this->language->get('error_title');
						}
					
						if (strlen(utf8_decode($value['description'])) < 3) {
							$this->error['description'][$language_id] = $this->language->get('error_description');
						}
					}
				}
			]]></add>
		</operation>
		
	</file>
	
	<file name="admin/controller/catalog/product.php">
	
		<operation>
			<search position="replace" offset="6"><![CDATA[if (isset($this->request->post['keyword'])) {]]></search>
			<add trim="true"><![CDATA[]]></add>
		</operation>
		
		<operation>
			<search position="replace" offset="4"><![CDATA[foreach ($this->request->post['product_description'] as $language_id => $value) {]]></search>
			<add trim="true"><![CDATA[
				$default_lang = $this->db->query("SELECT language_id FROM " . DB_PREFIX . "language WHERE code = '" . $this->config->get('config_language') . "'")->row['language_id'];
				foreach ($this->request->post['product_description'] as $language_id => $value) {
				if($language_id == $default_lang){
							if ((strlen(utf8_decode($value['name'])) < 1) || (strlen(utf8_decode($value['name'])) > 255)) {
								$this->error['name'][$language_id] = $this->language->get('error_name');
							}
				}
				}
			]]></add>
		</operation>
		
	</file>
	
	<file name="admin/model/catalog/category.php">

		<operation>
			<search position="after"><![CDATA[public function addCategory($data) {]]></search>
			<add><![CDATA[		$default_lang = $this->db->query("SELECT language_id FROM " . DB_PREFIX . "language WHERE code = '" . $this->config->get('config_language') . "'")->row['language_id'];]]></add>
		</operation>
		
		<operation>
			<search position="before" index="1"><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "category_description SET]]></search>
			<add><![CDATA[
      if($this->config->get('multilingual_seo_insertautotitle'))
      {
        $value['name'] = ($value['name']) ? $value['name'] : $data['category_description'][$default_lang]['name'];
        $value['description'] = ($value['description']) ? $value['description'] : $data['category_description'][$default_lang]['description'];
      }

			$this->load->model('tool/seo_package');
		
			if(!$value['seo_keyword'] && $this->config->get('multilingual_seo_insertautourl')){
				$seo_kw = $this->model_tool_seo_package->transformCategory($this->config->get('seo_category_url_pattern'), $language_id, $data);
			}else{
				$seo_kw = html_entity_decode($value['seo_keyword'], ENT_QUOTES, 'UTF-8');
			}
			$seo_kw = $this->model_tool_seo_package->filter_seo($seo_kw, 'category', $category_id);

			$this->db->query("INSERT INTO " . DB_PREFIX . "url_alias SET query = 'category_id=" . (int)$category_id . "', language_id = '" . (int)$language_id . "', keyword = '" . $this->db->escape($seo_kw) . "'");
			
			if(!$value['seo_title'] && $this->config->get('multilingual_seo_editautoseotitle')){
				$value['seo_title'] = $this->model_tool_seo_package->transformCategory($this->config->get('seo_category_title_pattern'), $language_id, $data);
			}
			if(!$value['meta_description'] && $this->config->get('multilingual_seo_editautometadesc')){
				$value['meta_description'] = $this->model_tool_seo_package->transformCategory($this->config->get('seo_category_description_pattern'), $language_id, $data);
			}
			if(!$value['meta_keyword'] && $this->config->get('multilingual_seo_editautometakeyword')){
				$value['meta_keyword'] = $this->model_tool_seo_package->transformCategory($this->config->get('seo_category_keyword_pattern'), $language_id, $data);
			}
			]]></add>
		</operation>
		
		<operation>
			<search position="replace"><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "category_description SET]]></search>
			<add><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "category_description SET seo_keyword = '" . $this->db->escape($seo_kw) . "', seo_title = '" . $this->db->escape($value['seo_title']) . "',]]></add>
		</operation>
		
		<operation>
			<search position="replace" offset="2"><![CDATA[if ($data['keyword']) {]]></search>
			<add><![CDATA[]]></add>
		</operation>
		
		<operation>
			<search position="replace"><![CDATA[$this->db->query("DELETE FROM " . DB_PREFIX . "url_alias WHERE query = 'category_id=" . (int)$category_id. "'");]]></search>
			<add><![CDATA[]]></add>
		</operation>
		
		<operation>
			<search position="after"><![CDATA[$this->db->query("DELETE FROM " . DB_PREFIX . "category_description WHERE category_id = '" . (int)$category_id . "'");]]></search>
			<add><![CDATA[		$this->db->query("DELETE FROM " . DB_PREFIX . "url_alias WHERE query = 'category_id=" . (int)$category_id. "'");]]></add>
		</operation>
		
		<operation>
			<search position="after"><![CDATA[public function editCategory($category_id, $data) {]]></search>
			<add><![CDATA[		$default_lang = $this->db->query("SELECT language_id FROM " . DB_PREFIX . "language WHERE code = '" . $this->config->get('config_language') . "'")->row['language_id'];]]></add>
		</operation>
    
		<operation>
			<search position="before" index="2"><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "category_description SET]]></search>
			<add><![CDATA[
      if($this->config->get('multilingual_seo_editautotitle'))
      {
        $value['name'] = ($value['name']) ? $value['name'] : $data['category_description'][$default_lang]['name'];
        $value['description'] = ($value['description']) ? $value['description'] : $data['category_description'][$default_lang]['description'];
      }
			
			$this->load->model('tool/seo_package');
			
			if(!$value['seo_keyword'] && $this->config->get('multilingual_seo_editautourl')){
				$seo_kw = $this->model_tool_seo_package->transformCategory($this->config->get('seo_category_url_pattern'), $language_id, $data);
			}else{
				$seo_kw = html_entity_decode($value['seo_keyword'], ENT_QUOTES, 'UTF-8');
			}
			$seo_kw = $this->model_tool_seo_package->filter_seo($seo_kw, 'category', $category_id);
			
			$this->db->query("INSERT INTO " . DB_PREFIX . "url_alias SET query = 'category_id=" . (int)$category_id . "', language_id = '" . (int)$language_id . "', keyword = '" . $this->db->escape($seo_kw) . "'");
			
			if(!$value['seo_title'] && $this->config->get('multilingual_seo_editautoseotitle')){
				$value['seo_title'] = $this->model_tool_seo_package->transformCategory($this->config->get('seo_category_title_pattern'), $language_id, $data);
			}
			if(!$value['meta_description'] && $this->config->get('multilingual_seo_editautometadesc')){
				$value['meta_description'] = $this->model_tool_seo_package->transformCategory($this->config->get('seo_category_description_pattern'), $language_id, $data);
			}
			if(!$value['meta_keyword'] && $this->config->get('multilingual_seo_editautometakeyword')){
				$value['meta_keyword'] = $this->model_tool_seo_package->transformCategory($this->config->get('seo_category_keyword_pattern'), $language_id, $data);
			}
			]]></add>
		</operation>
		
		<operation>
			<search position="replace"><![CDATA[, (SELECT keyword FROM " . DB_PREFIX . "url_alias WHERE query = 'category_id=" . (int)$category_id . "') AS keyword]]></search>
			<add><![CDATA[]]></add>
		</operation>
		
		<operation>
			<search position="after"><![CDATA[$result['name'],]]></search>
			<add><![CDATA[				'seo_keyword'	   => $result['seo_keyword'],
			'seo_title'	   => $result['seo_title'],]]></add>
		</operation>
		
	</file>
	
	<file name="admin/model/catalog/product.php">
	
		<operation>
			<search position="after"><![CDATA[public function addProduct($data) {]]></search>
			<add><![CDATA[		$default_lang = $this->db->query("SELECT language_id FROM " . DB_PREFIX . "language WHERE code = '" . $this->config->get('config_language') . "'")->row['language_id'];]]></add>
		</operation>
		
		<operation>
			<search position="before" index="1"><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "product_description SET]]></search>
			<add><![CDATA[
      if($this->config->get('multilingual_seo_insertautotitle'))
      {
        $value['name'] = ($value['name']) ? $value['name'] : $data['product_description'][$default_lang]['name'];
        $value['description'] = ($value['description']) ? $value['description'] : $data['product_description'][$default_lang]['description'];
      }
			
			$this->load->model('tool/seo_package');
		
			$data['product_id'] = $product_id; // add product id into dataset for use with patterns
			
			if(!$value['seo_keyword'] && $this->config->get('multilingual_seo_insertautourl')){
				$seo_kw = $this->model_tool_seo_package->transformProduct($this->config->get('seo_product_url_pattern'), $language_id, $data);
      }else{
        $seo_kw = html_entity_decode($value['seo_keyword'], ENT_QUOTES, 'UTF-8');
			}
			$seo_kw = $this->model_tool_seo_package->filter_seo($seo_kw, 'product', $product_id);
			
			$this->db->query("INSERT INTO " . DB_PREFIX . "url_alias SET query = 'product_id=" . (int)$product_id . "', language_id = '" . (int)$language_id . "', keyword = '" . $this->db->escape($seo_kw) . "'");
			
			if(!$value['seo_title'] && $this->config->get('multilingual_seo_insertautoseotitle')){
				$value['seo_title'] = $this->model_tool_seo_package->transformProduct($this->config->get('seo_product_title_pattern'), $language_id, $data);
			}
			if(!$value['meta_description'] && $this->config->get('multilingual_seo_insertautometadesc')){
				$value['meta_description'] = $this->model_tool_seo_package->transformProduct($this->config->get('seo_product_description_pattern'), $language_id, $data);
			}
			if(!$value['meta_keyword'] && $this->config->get('multilingual_seo_insertautometakeyword')){
				$value['meta_keyword'] = $this->model_tool_seo_package->transformProduct($this->config->get('seo_product_keyword_pattern'), $language_id, $data);
			}
			]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "product_description SET]]></search>
			<add><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "product_description SET seo_keyword = '" . $this->db->escape($seo_kw) . "', seo_title = '" . $this->db->escape($value['seo_title']) . "',]]></add>
		</operation>
		
		<operation>
			<search position="replace" offset="2"><![CDATA[if ($data['keyword']) {]]></search>
			<add><![CDATA[]]></add>
		</operation>
		
		<operation>
			<search position="replace"><![CDATA[$this->db->query("DELETE FROM " . DB_PREFIX . "url_alias WHERE query = 'product_id=" . (int)$product_id. "'");]]></search>
			<add><![CDATA[]]></add>
		</operation>
		
		<operation>
			<search position="after"><![CDATA[$this->db->query("DELETE FROM " . DB_PREFIX . "product_description WHERE product_id = '" . (int)$product_id . "'");]]></search>
			<add><![CDATA[		$this->db->query("DELETE FROM " . DB_PREFIX . "url_alias WHERE query = 'product_id=" . (int)$product_id. "'");]]></add>
		</operation>
		
		<operation>
			<search position="after"><![CDATA[public function editProduct($product_id, $data) {]]></search>
			<add><![CDATA[		$default_lang = $this->db->query("SELECT language_id FROM " . DB_PREFIX . "language WHERE code = '" . $this->config->get('config_language') . "'")->row['language_id'];]]></add>
		</operation>
    
		<operation>
			<search position="before" index="2"><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "product_description SET]]></search>
			<add><![CDATA[
      if($this->config->get('multilingual_seo_editautotitle'))
      {
        $value['name'] = ($value['name']) ? $value['name'] : $data['product_description'][$default_lang]['name'];
        $value['description'] = ($value['description']) ? $value['description'] : $data['product_description'][$default_lang]['description'];
      }
			
			$this->load->model('tool/seo_package');
			
			if(!$value['seo_keyword'] && $this->config->get('multilingual_seo_editautourl')){
				$seo_kw = $this->model_tool_seo_package->transformProduct($this->config->get('seo_product_url_pattern'), $language_id, $data);
      }else{
        $seo_kw = html_entity_decode($value['seo_keyword'], ENT_QUOTES, 'UTF-8');
			}
			$seo_kw = $this->model_tool_seo_package->filter_seo($seo_kw, 'product', $product_id);
			
			$this->db->query("INSERT INTO " . DB_PREFIX . "url_alias SET query = 'product_id=" . (int)$product_id . "', language_id = '" . (int)$language_id . "', keyword = '" . $this->db->escape($seo_kw) . "'");
			
			if(!$value['seo_title'] && $this->config->get('multilingual_seo_editautoseotitle')){
				$value['seo_title'] = $this->model_tool_seo_package->transformProduct($this->config->get('seo_product_title_pattern'), $language_id, $data);
			}
			if(!$value['meta_description'] && $this->config->get('multilingual_seo_editautometadesc')){
				$value['meta_description'] = $this->model_tool_seo_package->transformProduct($this->config->get('seo_product_description_pattern'), $language_id, $data);
			}
			if(!$value['meta_keyword'] && $this->config->get('multilingual_seo_editautometakeyword')){
				$value['meta_keyword'] = $this->model_tool_seo_package->transformProduct($this->config->get('seo_product_keyword_pattern'), $language_id, $data);
			}
			]]></add>
		</operation>
		
		<operation>
			<search position="replace"><![CDATA[, (SELECT keyword FROM " . DB_PREFIX . "url_alias WHERE query = 'product_id=" . (int)$product_id . "') AS keyword]]></search>
			<add><![CDATA[]]></add>
		</operation>
		
		<operation>
			<search position="after"><![CDATA[$result['name'],]]></search>
			<add><![CDATA[				'seo_keyword'	   => $result['seo_keyword'],
      'seo_title'	   => $result['seo_title'],]]></add>
		</operation>
		
	</file>
	
	<file name="admin/model/catalog/information.php">
	
		<operation>
			<search position="after"><![CDATA[public function addInformation($data) {]]></search>
			<add><![CDATA[		$default_lang = $this->db->query("SELECT language_id FROM " . DB_PREFIX . "language WHERE code = '" . $this->config->get('config_language') . "'")->row['language_id'];]]></add>
		</operation>
		
		<operation>
			<search position="before" index="1"><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "information_description SET]]></search>
			<add><![CDATA[
      if($this->config->get('multilingual_seo_insertautotitle'))
      {
        $value['title'] = ($value['title']) ? $value['title'] : $data['information_description'][$default_lang]['title'];
        $value['description'] = ($value['description']) ? $value['description'] : $data['information_description'][$default_lang]['description'];
      }
			
			$this->load->model('tool/seo_package');
		
			if(!$value['seo_keyword'] && $this->config->get('multilingual_seo_insertautourl')){
				$seo_kw = $this->model_tool_seo_package->transformInformation($this->config->get('seo_information_url_pattern'), $language_id, $data);
			}else{
				$seo_kw = html_entity_decode($value['seo_keyword'], ENT_QUOTES, 'UTF-8');
			}
			$seo_kw = $this->model_tool_seo_package->filter_seo($seo_kw, 'information', $information_id);
		
			$this->db->query("INSERT INTO " . DB_PREFIX . "url_alias SET query = 'information_id=" . (int)$information_id . "', language_id = '" . (int)$language_id . "', keyword = '" . $this->db->escape($seo_kw) . "'");
		
			if(!$value['seo_title'] && $this->config->get('multilingual_seo_insertautoseotitle')){
				$value['seo_title'] = $this->model_tool_seo_package->transformInformation($this->config->get('seo_information_title_pattern'), $language_id, $data);
			}
			if(!$value['meta_description'] && $this->config->get('multilingual_seo_insertautometadesc')){
				$value['meta_description'] = $this->model_tool_seo_package->transformInformation($this->config->get('seo_information_description_pattern'), $language_id, $data);
			}
			if(!$value['meta_keyword'] && $this->config->get('multilingual_seo_insertautometakeyword')){
				$value['meta_keyword'] = $this->model_tool_seo_package->transformInformation($this->config->get('seo_information_keyword_pattern'), $language_id, $data);
			}
			]]></add>
		</operation>
		
		<operation>
			<search position="replace"><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "information_description SET]]></search>
			<add><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "information_description SET seo_keyword = '" . $this->db->escape($seo_kw) . "', seo_title = '" . $this->db->escape($value['seo_title']) . "', meta_keyword = '" . $this->db->escape($value['meta_keyword']) . "', meta_description = '" . $this->db->escape($value['meta_description']) . "',]]></add>
		</operation>
		
		<operation>
			<search position="replace" offset="2"><![CDATA[if ($data['keyword']) {]]></search>
			<add><![CDATA[]]></add>
		</operation>
		
		<operation>
			<search position="replace"><![CDATA[$this->db->query("DELETE FROM " . DB_PREFIX . "url_alias WHERE query = 'information_id=" . (int)$information_id. "'");]]></search>
			<add><![CDATA[]]></add>
		</operation>
		
		<operation>
			<search position="after"><![CDATA[$this->db->query("DELETE FROM " . DB_PREFIX . "information_description WHERE information_id = '" . (int)$information_id . "'");]]></search>
			<add><![CDATA[		$this->db->query("DELETE FROM " . DB_PREFIX . "url_alias WHERE query = 'information_id=" . (int)$information_id. "'");]]></add>
		</operation>
		
		<operation>
			<search position="after"><![CDATA[public function editInformation($information_id, $data) {]]></search>
			<add><![CDATA[		$default_lang = $this->db->query("SELECT language_id FROM " . DB_PREFIX . "language WHERE code = '" . $this->config->get('config_language') . "'")->row['language_id'];]]></add>
		</operation>
    
		<operation>
			<search position="before" index="2"><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "information_description SET]]></search>
			<add><![CDATA[
      if($this->config->get('multilingual_seo_editautotitle'))
      {
        $value['title'] = ($value['title']) ? $value['title'] : $data['information_description'][$default_lang]['title'];
        $value['description'] = ($value['description']) ? $value['description'] : $data['information_description'][$default_lang]['description'];
      }
			
			$this->load->model('tool/seo_package');
		
			if(!$value['seo_keyword'] && $this->config->get('multilingual_seo_editautourl')){
				$seo_kw = $this->model_tool_seo_package->transformInformation($this->config->get('seo_information_url_pattern'), $language_id, $data);
			}else{
				$seo_kw = html_entity_decode($value['seo_keyword'], ENT_QUOTES, 'UTF-8');
			}
			$seo_kw = $this->model_tool_seo_package->filter_seo($seo_kw, 'information', $information_id);
			
			$this->db->query("INSERT INTO " . DB_PREFIX . "url_alias SET query = 'information_id=" . (int)$information_id . "', language_id = '" . (int)$language_id . "', keyword = '" . $this->db->escape($seo_kw) . "'");
			
			if(!$value['seo_title'] && $this->config->get('multilingual_seo_insertautoseotitle')){
				$value['seo_title'] = $this->model_tool_seo_package->transformInformation($this->config->get('seo_information_title_pattern'), $language_id, $data);
			}
			if(!$value['meta_description'] && $this->config->get('multilingual_seo_insertautometadesc')){
				$value['meta_description'] = $this->model_tool_seo_package->transformInformation($this->config->get('seo_information_description_pattern'), $language_id, $data);
			}
			if(!$value['meta_keyword'] && $this->config->get('multilingual_seo_insertautometakeyword')){
				$value['meta_keyword'] = $this->model_tool_seo_package->transformInformation($this->config->get('seo_information_keyword_pattern'), $language_id, $data);
			}
			]]></add>
		</operation>
		
		<operation>
			<search position="replace"><![CDATA[, (SELECT keyword FROM " . DB_PREFIX . "url_alias WHERE query = 'information_id=" . (int)$information_id . "') AS keyword]]></search>
			<add><![CDATA[]]></add>
		</operation>
		
		<operation>
			<search position="after"><![CDATA[$result['title'],]]></search>
			<add><![CDATA[				'seo_keyword'	   => $result['seo_keyword'],
			  'seo_title'	   => $result['seo_title'],
			  'meta_description'       => $result['meta_description'],
			  'meta_keyword'       => $result['meta_keyword'],]]></add>
		</operation>
		
	</file>
	
	<file name="admin/view/template/catalog/category_form.tpl">
	
		<operation>
			<search position="replace" offset="1"><![CDATA[<td><?php echo $entry_keyword; ?></td>]]></search>
			<add><![CDATA[              <td colspan="2"></td>]]></add>
		</operation>
		
		<operation>
			<search position="before" offset="1"><![CDATA[<td><?php echo $entry_meta_description; ?></td>]]></search>
			<add><![CDATA[
        <tr>
					<td>SEO Title:</td>
					<td><input type="text" name="category_description[<?php echo $language['language_id']; ?>][seo_title]" size="100" value="<?php echo isset($category_description[$language['language_id']]) ? $category_description[$language['language_id']]['seo_title'] : ''; ?>" /></td>
			  </tr>
      ]]></add>
    </operation>
		
		<operation>
			<search position="after" offset="2"><![CDATA[<td><?php echo $entry_description; ?></td>]]></search>
			<add><![CDATA[
			  <tr>
					<td><?php echo $entry_keyword; ?></td>
					<td><input type="text" name="category_description[<?php echo $language['language_id']; ?>][seo_keyword]" size="80" value="<?php echo isset($category_description[$language['language_id']]) ? $category_description[$language['language_id']]['seo_keyword'] : ''; ?>" /></td>
			  </tr>
			]]></add>
		</operation>
		
	</file>
	
	<file name="admin/view/template/catalog/product_form.tpl">
	
		<operation>
			<search position="replace" offset="1"><![CDATA[<td><?php echo $entry_keyword; ?></td>]]></search>
			<add><![CDATA[              <td colspan="2"></td>]]></add>
		</operation>
		
		<operation>
			<search position="before" offset="1"><![CDATA[<td><?php echo $entry_meta_description; ?></td>]]></search>
			<add><![CDATA[
        <tr>
					<td>SEO Title:</td>
					<td><input type="text" name="product_description[<?php echo $language['language_id']; ?>][seo_title]" size="100" value="<?php echo isset($product_description[$language['language_id']]) ? $product_description[$language['language_id']]['seo_title'] : ''; ?>" /></td>
			  </tr>
      ]]></add>
    </operation>
    
		<operation>
			<search position="after" offset="2"><![CDATA[<td><?php echo $entry_tag; ?></td>]]></search>
			<add><![CDATA[
			  <tr>
					<td><?php echo $entry_keyword; ?></td>
					<td><input type="text" name="product_description[<?php echo $language['language_id']; ?>][seo_keyword]" size="80" value="<?php echo isset($product_description[$language['language_id']]) ? $product_description[$language['language_id']]['seo_keyword'] : ''; ?>" /></td>
			  </tr>
			]]></add>
		</operation>
		
	</file>
	
	<file name="admin/view/template/catalog/information_form.tpl">
	
		<operation>
			<search position="replace" offset="2"><![CDATA[<td><?php echo $entry_keyword; ?></td>]]></search>
			<add><![CDATA[]]></add>
		</operation>
		<operation>
			<search position="before" offset="1"><![CDATA[<td><span class="required">*</span> <?php echo $entry_description; ?></td>]]></search>
			<add><![CDATA[
        <tr>
					<td>SEO Title:</td>
					<td><input type="text" name="information_description[<?php echo $language['language_id']; ?>][seo_title]" size="100" value="<?php echo isset($information_description[$language['language_id']]) ? $information_description[$language['language_id']]['seo_title'] : ''; ?>" /></td>
			  </tr>
        <tr>
          <td>Meta Tag Description:</td>
          <td><textarea name="information_description[<?php echo $language['language_id']; ?>][meta_description]" cols="40" rows="5"><?php echo isset($information_description[$language['language_id']]) ? $information_description[$language['language_id']]['meta_description'] : ''; ?></textarea></td>
        </tr>
        <tr>
          <td>Meta Tag Keywords:</td>
          <td><textarea name="information_description[<?php echo $language['language_id']; ?>][meta_keyword]" cols="40" rows="5"><?php echo isset($information_description[$language['language_id']]) ? $information_description[$language['language_id']]['meta_keyword'] : ''; ?></textarea></td>
        </tr>
				]]></add>
		</operation>
		
		<operation>
			<search position="after" offset="2"><![CDATA[<span class="error"><?php echo $error_description[$language['language_id']]; ?></span>]]></search>
			<add><![CDATA[
			  <tr>
					<td><?php echo $entry_keyword; ?></td>
					<td><input type="text" name="information_description[<?php echo $language['language_id']; ?>][seo_keyword]" size="80" value="<?php echo isset($information_description[$language['language_id']]) ? $information_description[$language['language_id']]['seo_keyword'] : ''; ?>" /></td>
			  </tr>
			]]></add>
		</operation>
		
	</file>
	
  <!-- titles and meta -->
  <file name="catalog/model/catalog/product.php">
    <operation>
			<search position="before"><![CDATA[$query->row['name'],]]></search>
			<add><![CDATA['seo_title'             => $query->row['seo_title'],]]></add>
		</operation>
  </file>
  
  <file name="catalog/controller/product/product.php">
		<operation>
			<search position="replace"><![CDATA[$this->document->setTitle($product_info['name']);]]></search>
			<add><![CDATA[$this->document->setTitle(($product_info['seo_title'] ? $product_info['seo_title'] : $product_info['name']));]]></add>
		</operation>
	</file>
  
  <file name="catalog/controller/product/category.php">
		<operation>
			<search position="replace"><![CDATA[$this->document->setTitle($category_info['name']);]]></search>
			<add><![CDATA[$this->document->setTitle(($category_info['seo_title'] ? $category_info['seo_title'] : $category_info['name']));]]></add>
		</operation>
	</file>
  
  <file name="catalog/controller/information/information.php">
		<operation>
			<search position="after"><![CDATA[$this->document->setTitle($information_info['title']);]]></search>
			<add><![CDATA[
				$this->document->setKeywords($information_info['meta_keyword']);
				$this->document->setDescription($information_info['meta_description']);
			]]></add>
		</operation>
    <operation>
			<search position="replace"><![CDATA[$this->document->setTitle($information_info['title']);]]></search>
			<add><![CDATA[$this->document->setTitle(($information_info['seo_title'] ? $information_info['seo_title'] : $information_info['title']));]]></add>
		</operation>	
	</file>
	
  <!-- seo engine -->
	<file name="catalog/controller/common/seo_url.php">
		
		<operation>
			<search position="replace"><![CDATA[if (isset($this->request->get['_route_'])) {]]></search>
			<add><![CDATA[	if($this->config->get('multilingual_seo_flag') && !isset($this->request->get['_route_']) && !isset($this->request->get['route'])){
			if($this->config->get('multilingual_seo_default_lang') == $this->session->data['language'])
				return $this->forward('common/home');
			else $this->redirect($this->url->link('common/home'));
			}
			if (isset($this->request->get['_route_']) && $this->request->get['_route_']) {
			$this->request->get['_route_'] = str_replace($this->config->get('multilingual_seo_extension'), '', $this->request->get['_route_']);]]></add>
		</operation>
		
		<operation error="skip"><!--v1.5.4-->
			<search position="before"><![CDATA[return $url_data['scheme']]]></search>
			<add><![CDATA[
				if($this->config->get('multilingual_seo_flag') && !($this->config->get('multilingual_seo_flag_default') && ($this->config->get('multilingual_seo_default_lang') == $lang)))
					$url = ($this->config->get('multilingual_seo_flag_upper')) ? '/'.strtoupper($lang).$url : '/'.$lang.$url;
			]]></add>
		</operation>
    <operation error="skip"><!--v1.5.5-->
			<search position="before"><![CDATA[return $url_info['scheme']]]></search>
			<add><![CDATA[
				if($this->config->get('multilingual_seo_flag') && !($this->config->get('multilingual_seo_flag_default') && ($this->config->get('multilingual_seo_default_lang') == $lang)))
					$url = ($this->config->get('multilingual_seo_flag_upper')) ? '/'.strtoupper($lang).$url : '/'.$lang.$url;
			]]></add>
		</operation>
		
		<operation>
			<search position="before"><![CDATA[$query .= '&' . $key . '=' . $value;]]></search>
			<add><![CDATA[				if($key != 'site_language')]]></add>
		</operation>
		
		<operation>
			<search position="after"><![CDATA[public function rewrite($link) {]]></search>
			<add><![CDATA[
				$this->load->model('localisation/language');
				$languagesById = $this->model_localisation_language->getLanguages();
				if($this->session->data['language'] !== $this->config->get('config_language')){
					$languages = array();
					foreach ($languagesById as $result){ $languages[$result['code']] = $result; }
					$this->config->set('config_language_id', $languages[ $this->session->data['language'] ]['language_id']);
				}
				$lang = $this->session->data['language'];
			]]></add>
		</operation>
		
		<operation>
			<search position="replace"><![CDATA[elseif ($key == 'path') {]]></search>
			<add><![CDATA[
					elseif($this->config->get('multilingual_seo_friendly') && ($key == 'route') && in_array($value, array_keys($this->config->get('multilingual_seo_urls_'.$lang)))) {
						$friendly = $this->config->get('multilingual_seo_urls_'.$lang);
						$url .= '/'.$friendly[$data['route']] . ($friendly[$data['route']] ? $this->config->get('multilingual_seo_extension') : '');
					} elseif (isset($data['route']) && $data['route'] == 'common/home') {
						$url .= '/';
					} elseif ($key == 'path') {
			]]></add>
		</operation>
		<operation>
			<search position="before"><![CDATA[if (isset($this->request->get['route'])) {]]></search>
			<add><![CDATA[
						elseif($this->config->get('multilingual_seo_friendly')) {
							$friendly = $this->config->get('multilingual_seo_urls_'.$this->session->data['language']);
							if(in_array($this->request->get['_route_'], $friendly)){
								$friendly = array_flip($friendly);
								$this->request->get['route'] = $friendly[$this->request->get['_route_']];
							}
						}
			]]></add>
		</operation>
		<operation>
			<search position="after"><![CDATA[if ($url[0] == 'category_id') {]]></search>
			<add><![CDATA[
					 if($this->config->get('multilingual_seo_absolute') && isset($this->request->get['path'])){
							$parent_id = str_replace('_', '', strrchr($this->request->get['path'], '_') ? strrchr($this->request->get['path'], '_') : $this->request->get['path']);
							$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "url_alias u left join " . DB_PREFIX . "category c on c.category_id = REPLACE(u.query, 'category_id=', '') WHERE u.keyword = '" . $this->db->escape($part) . "' AND c.parent_id = '" . $this->db->escape($parent_id) . "'");
              			if(isset($query->row['query']))
							$url = explode('=', $query->row['query']);
						}
			]]></add>
		</operation>
		
		<!-- manage extension -->
		<operation>
			<search position="before" index="1"><![CDATA[$url .= '/' . $query->row['keyword'];]]></search>
			<add><![CDATA[if(!(($data['route'] == 'product/manufacturer/info' || $data['route'] == 'product/product') && $key == 'manufacturer_id')) $url .= '/' . $query->row['keyword'] . $this->config->get('multilingual_seo_extension'); else]]></add>
		</operation>

		<operation>
			<search position="replace"><![CDATA[$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "url_alias WHERE `query` = '" . $this->db->escape($key . '=' . (int)$value) . "'");]]></search>
			<add><![CDATA[
						$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "url_alias WHERE `query` = '" . $this->db->escape($key . '=' . (int)$value) . "'".
								 " AND (`language_id` = '" . (int)$this->config->get('config_language_id') . "' OR `language_id` = 0)");
			]]></add>
		</operation>
		
		<operation>
			<search position="replace"><![CDATA[$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "url_alias WHERE `query` = 'category_id=" . (int)$category . "'");]]></search>
			<add><![CDATA[
							$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "url_alias WHERE `query` = 'category_id=" . (int)$category . "'".
									 " AND (`language_id` = '" . (int)$this->config->get('config_language_id') . "' OR `language_id` = 0)");
			]]></add>
		</operation>
		
	</file>
	
	<file name="catalog/controller/feed/google_sitemap.php">
		
		<operation>
			<search position="after"><![CDATA[$this->load->model('catalog/product');]]></search>
			<add><![CDATA[
			$this->load->model('localisation/language');
			$languages = array();
			$results = $this->model_localisation_language->getLanguages();
			foreach ($results as $result) {
				if ($result['status']) {
					$languages[] = array(
						'language_id'  => $result['language_id'],
						'code'  => $result['code']
					);	
				}
			}
      foreach ($languages as $lang) {
				$this->config->set('config_language_id', $lang['language_id']);
        $this->session->data['language'] = $lang['code'];
			]]></add>
		</operation>
		
		<operation>
			<search position="before"><![CDATA[$output .= '</urlset>';]]></search>
			<add><![CDATA[		 	}]]></add>
		</operation>
	</file>
  
  <!-- ML banners -->
  <file name="catalog/model/design/banner.php">
  	<operation>
			<search position="before"><![CDATA[return $query->rows;]]></search>
			<add><![CDATA[
        if($this->config->get('multilingual_seo_banners'))
        {
          foreach($query->rows as &$row){
            $route = $row['link'];
            if($params = strstr($row['link'], '&'))
              $route = str_replace(array($params, 'index.php?route='), '', $row['link']);
            else $params = '';
            $row['link'] = $this->url->link($route, str_replace('&amp;', '&', $params));
          }
        }
       ]]></add>
		</operation>
	</file>
	
	<file path="admin/view/template/common/" name="header.tpl">
		<operation>
			<search position="after"><![CDATA[<li><a href="<?php echo $feed; ?>">]]></search>
			<add><![CDATA[
			<?php $this->load->model('setting/extension'); if(in_array('complete_seo', $this->model_setting_extension->getInstalled('module'))){ ?>
			<li><a href="<?php echo $this->url->link('module/complete_seo', 'token=' . $this->session->data['token'], 'SSL'); ?>"><img style="vertical-align:top" src="view/seo_package/img/icon.png"/> Complete SEO</a></li>
			<?php }else{ ?>
			<li><a href="<?php echo $this->url->link('extension/module/install', 'extension=complete_seo&token=' . $this->session->data['token'], 'SSL'); ?>"><img style="vertical-align:top" src="../seo_package/img/icon.png"/> Install Complete SEO</a></li>
			<?php } ?>
			]]></add>
		</operation>
	</file>
	
	<file name="catalog/controller/common/home.php">
		<operation>
			<search position="before"><![CDATA[$this->response->setOutput($this->render());]]></search>
			<add><![CDATA[
		// seo meta
		$seo_meta = $this->config->get('multilingual_seo_store');
		if (isset($seo_meta[$this->config->get('config_store_id').$this->config->get('config_language_id')])) {
			$seo_meta = $seo_meta[$this->config->get('config_store_id').$this->config->get('config_language_id')];
		}
		
		if (isset($seo_meta['seo_title']) && $seo_meta['seo_title']) {
			$this->document->setTitle($seo_meta['seo_title']);
		} else {
			$this->document->setTitle($this->config->get('config_title'));
		}
		
		if (isset($seo_meta['description']) && $seo_meta['description']) {
			$this->document->setDescription($seo_meta['description']);
		} else {
			$this->document->setDescription($this->config->get('config_meta_description'));
		}
		
		if (isset($seo_meta['keywords']) && $seo_meta['keywords']) {
			$this->document->setKeywords($seo_meta['keywords']);
		}
		
		if (isset($seo_meta['title']) && $seo_meta['title']) {
			$this->data['heading_title'] = $seo_meta['title'];
		} else {
			$this->data['heading_title'] = $this->config->get('config_title');
		}
		// end - seo meta
			]]></add>
		</operation>
	</file>
</modification>